Основная идея
Когда на одного из игроков поставлено больше, чем на других, это может указывать на то, что игрок считается более вероятным победителем. Чтобы отразить это в коэффициентах, мы уменьшаем коэффициент этого игрока. Уменьшение коэффициента делает ставку на этого игрока менее выгодной, что помогает сбалансировать распределение ставок.
Как это работает
Расчет базовых коэффициентов:
Для каждого игрока рассчитывается базовый коэффициент как отношение общей суммы ставок (с учетом добавленной константы) к сумме ставок на этого игрока.
Расчет разницы в процентах:
Для каждого игрока вычисляется разница в процентах между его суммой ставок и суммой ставок на остальных игроков. Это делается по формуле: [ \text{differencePercentagePlayerX} = \frac{\text{adjustedTotalPlayerX} - \text{sumOtherPlayersX}}{\text{sumOtherPlayersX}} ]
Если разница положительная, это означает, что на этого игрока поставлено больше, чем на остальных.
Корректировка коэффициентов:
Если разница в процентах положительная, коэффициент этого игрока уменьшается. Уменьшение происходит по формуле: [ \text{oddsPlayerX} /= (1 + \text{differencePercentagePlayerX}) ]
Это означает, что коэффициент делится на величину, большую единицы, что приводит к его уменьшению.
Пример
Предположим, у нас есть три игрока, и на первого игрока поставлено значительно больше, чем на второго и третьего. В этом случае:
Базовый коэффициент для первого игрока будет рассчитан как отношение общей суммы ставок к его сумме ставок.
Разница в процентах покажет, насколько больше поставлено на первого игрока по сравнению с другими.
Корректировка уменьшит коэффициент первого игрока, деля его на величину, большую единицы, что делает ставку на него менее выгодной.
Таким образом, корректировка коэффициентов помогает сбалансировать ставки и учесть рыночные ожидания, делая ставки на более популярных игроков менее привлекательными.


Объяснение изменений:
Учет флагов: Мы добавляем константу только к тем суммам, для которых флаг установлен в true, чтобы учитывать только активные ставки.
Расчет разницы: Мы рассчитываем разницу в процентах между суммой ставок на каждого игрока и суммой ставок на остальных двух игроков.
Корректировка коэффициентов: Если на одного из игроков поставили больше, чем на остальных, его коэффициент уменьшается пропорционально разнице в процентах.
Эта логика позволяет динамически корректировать коэффициенты, учитывая только активные ставки и распределение ставок между тремя игроками.