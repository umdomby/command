
я хочу продавать свою программу JoyControl в интернете, хочу дать тестовое использование 2 часа в сутки, у меня есть сайт NextJS где программа может подключаться для авторизации, 
программа защищается Native AOT
с базой данных Postgres и next js для админки и регистрации с токенами 
программа будет продаваться на год или два, так что в Prisma нужно учитывать и даты, так же программа должна будет смотреть два поля по активации (админом если пользователь оплатил) и по дате, если дата просрочена то оповещаем клиента в C# и отключаем доступ

ДАвать пользователю 2 часа в сутки + периодических проверок JWT — это стандарт де-факто в 2025–2026 годах для десктопных приложений с онлайн-активацией. (что бы при новой установки нельзя было пользоваться копией программы, дополнительно в системе устанавливается единое время, возможно проверка времени через сервер, время по гринвичу?)
Клиент (C# WinForms/WPF)  
↓ HTTPS
↓ NEXT
↔ PostgreSQL Prisma
Admin + регистрация покупателей (Next.js 16 App Router)

| Место проверки                                      | Частота                                             | Что именно проверять                                      | Зачем именно здесь                                      |
|-----------------------------------------------------|-----------------------------------------------------|------------------------------------------------------------|---------------------------------------------------------|
| При запуске приложения                              | 1 раз при старте                                    | Обязательная проверка + загрузка токена                    | Блокирует запуск без валидного триала/лицензии          |
| Перед началом отправки данных в виртуальный контроллер (ViGEm ) | Каждый раз при активации читалки / каждые 30–60 сек | Быстрая проверка (только локально: expired?)               | Самое ценное место — здесь живёт монетизация            |
| В uiTimer (16–33 мс тик)                            | Каждый час                                          | Полная онлайн-проверка (запрос к серверу)                  | Обнаруживает подмену системного времени                 |
| При нажатии «SAVE», «ADD DEVICE», открытии настроек | 1 раз на действие                                   | Локальная проверка + иногда онлайн                         | Дополнительные точки «зацепа»                           |
| В критических классах (ControllerReader, SendReport и т.п.) | При каждом отправляемом отчёте                      | Минимальная проверка (токен не null + не expired)          | Очень тяжело вырезать все вызовы                        |


NEXT JS (серверные функции или как это будет реализовано в NEXT) будет просматривать время по гринвичу?


Сделай нужные поля в Prisma API Actions aдминка для админа чтобы давать пользователям доступ (когда админ дал доступ автоматически устанавливается и время)
так же админ мог просматривать сколько пользуется в тестовом 2 часа в сутки.
Давай для теста сделаем минимальную регистрацию в C# приложении и минимальный код доступ для старта и проверки всей логики с NEXT JS

https://ardu.live:444/profile страница регистрации на сайте


Замени простой токен на настоящий JWT (jose в Next.js + System.IdentityModel.Tokens.Jwt в C# — Native AOT поддерживает).
Добавь удаление лицензии, лицензия может быть только одна, добавь чтобы админ мог устанавливать дату лицензии год число и месяц
Добавь machine-id проверку (HWID) на сервере, чтобы копия на другом ПК не работала.
В production сделай токен на 30–60 мин + refresh.
C# сделай класс регистрации и входа, пока C# пока программу C# сильно не нагружай. после добавим код защиты в другие классы.