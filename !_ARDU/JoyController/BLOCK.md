{
// Можно заблокировать функционал, если отказался
// Например:
// activeReaders.Clear();
// uiTimer.Stop();
// lblLicenseStatus.Text += " (функции заблокированы)";
}


Краткий итог — где именно изменения:

ТОЧКА 1 — после if (license == null) (ошибка сервера)
ТОЧКА 2 — в блоке else когда подписка истекла
ТОЧКА 3 — в блоке else когда триал исчерпан (rem <= 0)
ТОЧКА 4 — в конце метода — финальная проверка цвета (если не зелёный/золотой)

После этих правок:

при "Не выполнен вход", "триал исчерпан", "подписка истекла" — все таймеры останавливаются
локальное время не уменьшается
контроллеры отключаются
программа перестаёт тратить ресурсы в фоне

Вставь эти 4 точки + метод DisableFeaturesOnLicenseExpire() — и готово.


3. Как это работает в итоге

При успешном heartbeat/validate → состояние сохраняется в lastKnown*
При следующем запуске без интернета → Form1_Load → catch → TryRestoreOfflineState → если платная лицензия ещё не истекла → программа запускает джойстик и всё остальное
Токен обновляется автоматически при heartbeat (если сервер дал newToken)
Подмена токена всё ещё возможна, но файл зашифрован — обычный пользователь не сможет просто открыть и заменить

Всё готово. Если нужно добавить шифрование ключа или AES — скажи.